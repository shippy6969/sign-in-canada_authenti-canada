<!DOCTYPE html>
<html class="no-js" lang="en" dir="ltr">
  
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <!-- Web Experience Toolkit (WET) / Boîte à outils de l'expérience Web (BOEW)
		  wet-boew.github.io/wet-boew/License-en.html / wet-boew.github.io/wet-boew/Licence-fr.html -->
  <title>Integrating Azure Active Directory B2C</title>
  <meta content="width=device-width,initial-scale=1" name="viewport">
  <!-- Meta data -->
  <meta name="description" content="Sign In Canada.">
  <!-- Meta data-->
  <!--[if gte IE 9 | !IE ]><!-->
  <link href="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_0_31/assets/favicon.ico" rel="icon" type="image/x-icon">
  <link rel="stylesheet" href="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_0_31/css/theme.min.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
  <link rel="stylesheet" href="/sign-in-canada_authenti-canada/assets/style.css">
  <!--<![endif]-->
  <!--[if lt IE 9]>
  <link href="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_0_31/assets/favicon.ico" rel="shortcut icon" />
  <link rel="stylesheet" href="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_0_31/css/ie8-theme.min.css" />
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_0_31/js/ie8-wet-boew.min.js"></script>
	<![endif]-->
  <!--[if lte IE 9]> <![endif]-->
  <noscript><link rel="stylesheet" href="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_0_31/css/noscript.min.css"></noscript>
</head>
<body vocab="http://schema.org/" typeof="WebPage" class="page-integrate-b2c">
<ul id="wb-tphp">
  <li class="wb-slc"><a class="wb-sl" href="#wb-cont">Skip to main content</a></li>
  <li class="wb-slc visible-sm visible-md visible-lg"><a class="wb-sl" href="#wb-info">Skip to "About this site"</a></li>
</ul>

<header>
  <div id="wb-bnr" class="container">
    <section id="wb-lng" class="visible-md visible-lg text-right">
      <h2 class="wb-inv">Language selection</h2>
      <div class="row">
        <div class="col-md-12">
          <ul class="list-inline margin-bottom-none">
          </ul>
        </div>
      </div>
    </section>

    <div class="row">
      <div class="brand col-xs-8 col-sm-9 col-md-6">
        <a href="https://www.canada.ca/en.html">
          <img src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_0_31/assets/sig-blk-en.svg" alt="Government of Canada / Gouvernement du Canada">
          <span class="wb-inv"> Government of Canada / <span lang="fr">Gouvernement du Canada</span></span>
        </a>
      </div>

      <section class="wb-mb-links col-xs-4 col-sm-3 visible-sm visible-xs" id="wb-glb-mn">
        <h2>Menus</h2>
        <ul class="list-inline text-right chvrn">
          <li><a href="#mb-pnl" title="Menus" aria-controls="mb-pnl" class="overlay-lnk" role="button"><span class="glyphicon glyphicon-th-list"><span class="wb-inv">Menus</span></span></a></li>
        </ul>
        <div id="mb-pnl"></div>
      </section>
    </div>
  </div>

  <nav class="gcweb-menu" typeof="SiteNavigationElement">
    <div class="container nvbar">
      <h2 class="wb-inv">Menu</h2>
      <button type="button" aria-haspopup="true" aria-expanded="false"><span class="wb-inv">Main </span>Menu <span class="expicon glyphicon glyphicon-chevron-down"></span></button>
      <ul role="menu" aria-orientation="vertical">
        <li role="presentation"><a role="menuitem" href="/sign-in-canada_authenti-canada/en/discover/index.html">Discover</a></li>
        <li role="presentation"><a role="menuitem" href="/sign-in-canada_authenti-canada/en/evaluate/index.html">Evaluate</a></li>
        <li role="presentation"><a role="menuitem" href="/sign-in-canada_authenti-canada/en/join/index.html">Join</a></li>
        <li role="presentation"><a role="menuitem" href="/sign-in-canada_authenti-canada/en/contribute/index.html">Contribute</a></li>
      </ul>
    </div>
  </nav>
  <nav id="wb-bc" property="breadcrumb">
    <h2>You are here:</h2>
    <div class="container">
      <ol class="breadcrumb">
        <li><a href="/sign-in-canada_authenti-canada/en/index.html">Sign In Canada</a></li>
</ol>
    </div>
  </nav>
</header>

<main property="mainContentOfPage" class="container">

<h1 id="integrating-azure-active-directory-b2c">Integrating Azure Active Directory B2C</h1>

<p>Government of Canada digital services that leverage <a href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/overview">Azure Active Directory
B2C</a> to
centrally manage user identity data, and/or to authorize access to their
application programming interfaces can configure their B2C tenant to use
Sign In Canada as its authentication service. This allows your users to benefit from
being able to use the same trusted credential to access multiple government services,
while your applications benefit from all of the features provided by Azure Active
Directory B2C.</p>

<h2 id="requesting-connectivity-to-cate-for-your-b2c-tenant">Requesting Connectivity to CATE for your B2C tenant</h2>

<p>In order to integrate your non-production B2C tenant with the Sign In Canada
<a href="../discover/cate.html">Client Acceptance Test Environment</a> (CATE), please send
an email to <a href="mailto:Signin-AuthentiCanada@tbs-sct.gc.ca">Signin-AuthentiCanada@tbs-sct.gc.ca</a> with the following information:</p>

<ol>
  <li>The domain name of your B2C tenant. This can either be a default domain name
such as <code class="language-plaintext highlighter-rouge">https://&lt;tenant-name&gt;.b2clogin.com</code> or a <a href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/custom-domain?pivots=b2c-user-flow">custom
domain</a>.</li>
  <li>Your B2C <a href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/tenant-management#get-your-tenant-id">Tenant ID</a>
</li>
  <li>The name of your <a href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/add-sign-up-and-sign-in-policy?pivots=b2c-user-flow">user flow or custom policy</a>
</li>
</ol>

<p>The Sign in Canada team will use this information to configure your B2C tenant
as a client, and provide you with a client ID and client secret for your tenant.</p>

<div class="alert alert-info">
<p>
You must have a valid myKey credential so that the Sign in Canada team can send you these client credentials via encrypted email.
</p>
</div>

<h2 id="configuring-sign-in-canada-as-an-identity-provider">Configuring Sign In Canada as an Identity Provider</h2>

<p>To configure the Sign In Canada CATE environment as your B2C tenant’s external
identity provider you can follow <a href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/identity-provider-generic-openid-connect?pivots=b2c-user-flow#add-the-identity-provider">these instructions</a>
and use the following settings:</p>

<table class="table table-bordered table-condensed">
  <thead>
    <tr>
      <th>Setting</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Name</td>
      <td>Sign In Canada CATE</td>
    </tr>
    <tr>
      <td>Metadata URL</td>
      <td>https://te-auth.id.tbs-sct.gc.ca/oxauth/.well-known/openid-configuration</td>
    </tr>
    <tr>
      <td>Client ID</td>
      <td>[<em>as provided by the Sign In Canada team</em>]</td>
    </tr>
    <tr>
      <td>Client secret</td>
      <td>[<em>as provided by the Sign In Canada team</em>]</td>
    </tr>
    <tr>
      <td>Scope</td>
      <td>openid</td>
    </tr>
    <tr>
      <td>Response type</td>
      <td>code</td>
    </tr>
    <tr>
      <td>Response mode</td>
      <td>query</td>
    </tr>
    <tr>
      <td>Domain hint</td>
      <td>[<em>leave empty</em>]</td>
    </tr>
  </tbody>
</table>

<h5 id="identity-provider-claims-mappings">Identity provider claims mappings</h5>

<table class="table table-bordered table-condensed">
  <thead>
    <tr>
      <th>Name</th>
      <th>Claim to map</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>User ID</td>
      <td>sub</td>
    </tr>
    <tr>
      <td>Display name</td>
      <td>sub</td>
    </tr>
    <tr>
      <td>Given name</td>
      <td>[<em>leave empty</em>]</td>
    </tr>
    <tr>
      <td>Surname</td>
      <td>[<em>leave empty</em>]</td>
    </tr>
    <tr>
      <td>Email</td>
      <td>[<em>leave empty</em>]</td>
    </tr>
  </tbody>
</table>

<h2 id="known-issues">Known issues</h2>

<p>This is a current list of known interoperability issues between Azure Active
Directory and Sign In Canada, along with workarounds to address them.</p>

<h3 id="issue-1-b2c-does-not-include-an-id_token_hint-in-logout-requests-sent-to-an-external-identity-provider">Issue 1: B2C does not include an <code class="language-plaintext highlighter-rouge">id_token_hint</code> in logout requests sent to an external identity provider</h3>

<p><a href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/session-behavior?pivots=b2c-custom-policy#sign-out">Documented here</a></p>

<p>This forces Sign In Canada to rely on its session cookie, however that session
cookie will be blocked by most browsers as a third party cookie if the the B2C
tenant is hosted under a different top-level domain than Sign In Canada.</p>

<p><strong>Workaround</strong></p>

<p>The B2C tenant must be configured to use a custom domain that is in the same
top-level domain as the external IDP. In the case of Sign In Canada production
environment, that top level domain is canada.ca, so any production B2C tenant
<strong>must</strong> use a custom domain that is a subdomain under canada.ca.</p>

<h3 id="issue-2-b2c-does-not-provide-a-an-openid-logout-endpoint-that-accepts-single-logout-requests-coming-from-an-external-openid-provider">Issue 2: B2C does not provide a an OpenID logout endpoint that accepts single logout requests coming from an external OpenID provider</h3>

<p><strong>Workaround</strong></p>

<p>To log out the B2C session, The Sign In Canada platform can use the
front-channel logout endpoint that B2C provides to its own clients. The B2C
policy/user flow must be configured to not require the id_token_hint, since the
Sign In Canada platform has no way to obtain a B2C client’s ID token.</p>

<p>To log out the session at B2C’s clients, the Sign In Canada platform can send
each of them a logout request directly.</p>

<h3 id="issue-3-b2cs-logout-endpoint-sets-an-x-frame-options-header-to-deny-which-blocks-logout-requests-from-sign-in-canada">Issue 3: B2C’s logout endpoint sets an X-Frame-Options header to “deny” which blocks logout requests from Sign In Canada</h3>

<p><strong>Workaround</strong></p>

<p>A “Modify Response Header” rule can be configured on Azure Front Door to remove
the offending header.</p>


</main>


<footer role="contentinfo" id="wb-info">
  <nav role="navigation" class="container wb-navcurr">
    <h2 class="wb-inv">About government</h2>
    <ul class="list-unstyled colcount-sm-2 colcount-md-3">
      <li><a href="mailto:SignIn-AuthentiCanada@tbs-sct.gc.ca">Contact us</a></li>
      <li><a href="https://www.canada.ca/en/government/dept.html">Departments and agencies</a></li>
      <li><a href="https://www.canada.ca/en/government/publicservice.html">Public service and military</a></li>
      <li><a href="https://www.canada.ca/en/news.html">News</a></li>
      <li><a href="https://www.canada.ca/en/government/system/laws.html">Treaties, laws and regulations</a></li>
      <li><a href="https://www.canada.ca/en/transparency/reporting.html">Government-wide reporting</a></li>
      <li><a href="http://pm.gc.ca/eng">Prime Minister</a></li>
      <li><a href="https://www.canada.ca/en/government/system.html">How government works</a></li>
      <li><a href="http://open.canada.ca/en/">Open government</a></li>
    </ul>
  </nav>
  <div class="brand">
    <div class="container">
      <div class="row">
        <nav class="col-md-9 col-lg-10 ftr-urlt-lnk">
          <h2 class="wb-inv">About this site</h2>
          <ul>
            <li><a href="https://www.canada.ca/en/social.html">Social media</a></li>
            <li><a href="https://www.canada.ca/en/mobile.html">Mobile applications</a></li>
            <li><a href="https://www1.canada.ca/en/newsite.html">About Canada.ca</a></li>
            <li><a href="https://www.canada.ca/en/transparency/terms.html">Terms and conditions</a></li>
            <li><a href="https://www.canada.ca/en/transparency/privacy.html">Privacy</a></li>
          </ul>
        </nav>
        <div class="col-xs-6 visible-sm visible-xs tofpg">
          <a href="#wb-cont">Top of Page <span class="glyphicon glyphicon-chevron-up"></span></a>
        </div>
        <div class="col-xs-6 col-md-3 col-lg-2 text-right">
          <object type="image/svg+xml" tabindex="-1" role="img" data="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_0_31/assets/wmms-blk.svg" aria-label="Symbol of the Government of Canada"></object>
        </div>
      </div>
    </div>
  </div>
</footer>


<!--[if gte IE 9 | !IE ]><!-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.js"></script>
<script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_0_31/js/wet-boew.min.js"></script>
<!--<![endif]-->
<!--[if lt IE 9]>
<script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_0_31/js/ie8-wet-boew2.min.js"></script>
<![endif]-->
<script src="https://www.canada.ca/etc/designs/canada/cdts/gcweb/v4_0_31/js/theme.min.js"></script>

</body>

</html>
